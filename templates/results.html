{% extends "base.html" %}
{% block content %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div style="
  width:100%;
  height:calc(100vh - 120px);
  background: #854eecff;
  padding:30px 40px;
  color:#e5e7eb;
  display:flex;
  flex-direction:column;
">

  <!-- HEADER -->
  <div style="text-align:center; margin-bottom:20px;">
    <h2 style="margin:0;color:#ffffff;">ğŸ† Election Results</h2>
    <p style="color:#cbd5f5; margin-top:6px;">
      {{ election.name }}
    </p>
  </div>

  <!-- MAIN CONTENT -->
  <div style="
    flex:1;
    display:grid;
    grid-template-columns: 1.2fr 1fr;
    gap:40px;
    align-items:center;
  ">

    <!-- LEFT: PIE CHART -->
    <div style="
      width:100%;
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
    ">
      <canvas id="resultChart" style="max-width:420px; max-height:420px;"></canvas>
    </div>

    <!-- RIGHT: DETAILS -->
    <div style="width:100%;">

      <h3 style="margin-bottom:10px;color:#ffffff;">ğŸ“‹ Detailed Results</h3>

      <table style="
        width:100%;
        border-collapse:collapse;
        font-size:0.95rem;
        margin-bottom:16px;
      ">
        <thead>
          <tr style="background:#1e293b;">
            <th style="padding:10px; text-align:left; ">Candidate</th>
            <th style="padding:10px; text-align:right;">Votes</th>
          </tr>
        </thead>
        <tbody>
          {% for c in candidates %}
          <tr style="background:#1e293b;">
            <td style="padding:10px;">{{ c.name }}</td>
            <td style="padding:10px; text-align:right;">{{ c.votes }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <div style="font-size:0.95rem; line-height:1.7;">
        ğŸ† <strong>Winner:</strong> {{ winner.name }}<br>
        ğŸ§® <strong>Total Votes:</strong> {{ total_votes }}<br>
        ğŸ“ˆ <strong>Winning %:</strong> {{ win_percentage }}%<br>
        ğŸ“‰ <strong>Vote Difference:</strong> {{ vote_diff }}
      </div>

    <div style="text-align:center; margin-top:20px;">
    <a href="{{ back_url }}" style="color:#60a5fa; text-decoration:none;">
        â¬… Back to Dashboard
    </a>
    </div>

    </div>

    </div>

    </div>
  </div>
</div>

<script>
  new Chart(document.getElementById("resultChart"), {
    type: "pie",
    data: {
      labels: {{ candidates | map(attribute='name') | list | tojson }},
      datasets: [{
        data: {{ candidates | map(attribute='votes') | list | tojson }},
        backgroundColor: [
          "#3b82f6",
          "#22c55e",
          "#f59e0b",
          "#ef4444",
          "#a855f7"
        ],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {
        legend: {
          position: "bottom",
          labels: {
            color: "#f9fafb",
            boxWidth: 14
          }
        }
      }
    }
  });
</script>

{% endblock %}
